# ==================================================================
# RAILWAY CONFIG - Alvará de Pagamento Generator v2.0
# Node.js + Express + EJS + puppeteer-core (Chromium system)
# ==================================================================

[build]
builder = "NIXPACKS"
NIXPACKS_NODE_VERSION = "20"
# Instala dependências sem devDependencies
NIXPACKS_BUILD_CMD = "npm install --omit=dev"

# Pacotes necessários para Chromium headless no Railway
NIXPACKS_PKGS = """
chromium
libnss3
libxss1
libasound2
libatk1.0-0
libatk-bridge2.0-0
libx11-6
libx11-xcb1
libxcomposite1
libxdamage1
libxext6
libxfixes3
libxrandr2
libgbm1
libpangocairo-1.0-0
libpango-1.0-0
libgtk-3-0
fonts-noto
fonts-noto-extra
fonts-noto-color-emoji
fonts-dejavu-core
"""

# ==================================================================
# DEPLOY CONFIG
# ==================================================================
[deploy]
# Comando de inicialização do app
startCommand = "node index.js"

# Porta padrão do Express (Railway substitui automaticamente via $PORT)
port = 3000

# Opcional: definir healthcheck endpoint
healthcheckPath = "/_health"
healthcheckTimeout = 15
healthcheckInterval = 30

# ==================================================================
# ENVIRONMENT VARIABLES
# ==================================================================
[variables]
# Define o caminho do binário Chromium usado pelo puppeteer-core
CHROME_PATH = "/usr/bin/chromium"
NODE_ENV = "production"
